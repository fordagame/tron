var __extends,Tron;(function(n){var t=function(){function n(n){this.sandbox=n;this.subscriptionTokens=[]}return n.prototype.init=function(){},n.prototype.destroy=function(){this.removeEvents()},n.prototype.addEventToken=function(n){this.subscriptionTokens.push(n)},n.prototype.removeEvents=function(){var n,t;for(n in this.subscriptionTokens)t=this.subscriptionTokens[n],t.destroy()},n}();n.BaseModule=t})(Tron||(Tron={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(n){return t.call(this,n)||this}return __extends(i,t),i.prototype.init=function(n){t.prototype.init.call(this,n);var i=this.sandbox.getService("dependency");i.addResourceDepndency("application");i.addResourceDepndency("games");i.executeDependencies(this.initRequirements.bind(this,n))},i.prototype.initRequirements=function(t){this.presenter=new n.GamesPresenter(this.sandbox,new n.GamesView(this.sandbox.getTemplate("GamesModule")));this.presenter.view.presenter=this.presenter;this.root=t.root;this.root.innerHTML="";this.root.appendChild(this.presenter.render())},i.prototype.destroy=function(){t.prototype.destroy.call(this);this.presenter.destroy()},i}(n.BaseModule);n.GamesModule=t}(Tron||(Tron={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(n){return t.call(this,n)||this}return __extends(i,t),i.prototype.init=function(n){t.prototype.init.call(this,n);var i=this.sandbox.getService("dependency");i.addResourceDepndency("application");i.addResourceDepndency("tron");i.executeDependencies(this.initRequirements.bind(this,n))},i.prototype.initRequirements=function(t){var u,i,f,e,r;this.presenter=new n.TronPresenter(this.sandbox,new n.TronView(this.sandbox.getTemplate("TronModule")));this.presenter.view.presenter=this.presenter;this.presenter.gameId=this.gameId=t.parameters.gameId;u=this.sandbox.getService("users");i=this.sandbox.getService("websocket");this.wsSubscriptions=[];f=this.receivePlayerDataUpdate.bind(this);this.wsSubscriptions.PlayerData=f;e=this.receiveGameDataUpdate.bind(this);this.wsSubscriptions.GameUpdate=e;for(r in this.wsSubscriptions)i.subscribeForMessage(r,this.wsSubscriptions[r]);i.addPlayer(this.gameId,u.getUser().name);this.root=t.root;this.root.innerHTML="";this.root.appendChild(this.presenter.render())},i.prototype.receivePlayerDataUpdate=function(t){var i=new n.TronPlayerUpdate;i.deserialize(t.data);this.presenter.updateGameData(i)},i.prototype.receiveGameDataUpdate=function(t){var i=new n.TronGameUpdate;i.deserialize(t.data);this.presenter.updateGameState(i)},i.prototype.destroy=function(){var i,n;t.prototype.destroy.call(this);this.presenter.destroy();i=this.sandbox.getService("websocket");for(n in this.wsSubscriptions)i.unsubscribeForMessage(n,this.wsSubscriptions[n])},i}(n.BaseModule);n.TronModule=t}(Tron||(Tron={}));