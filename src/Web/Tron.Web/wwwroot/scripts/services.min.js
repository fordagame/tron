var __extends,Tron;(function(n){var t=function(){function t(n){this.serviceUrl="";this.serviceUrl=n;t.successFunc||(t.successFunc=[],t.resultCache=[])}return t.prototype.setTimeoutfunc=function(){return""},t.prototype.getData=function(i,r,u){var f=this.getKey(i),e;if(t.resultCache[f]){u(r(t.resultCache[f]));return}t.successFunc[f]||(e=this,n.app.ajax(e.url(i),{method:"Get",converter:function(n){return n},success:e.success.bind(e,f),error:function(n){console.info("Error ocur in getData!");console.info(n)}}));this.addObj(f,r,u)},t.prototype.postData=function(i,r,u,f,e){if(i=i+this.url(r),t.resultCache[i]){f(u(t.resultCache[i]));return}if(!t.successFunc[i]){var o=this;n.app.ajax(o.url(r),{method:"Post",data:e,converter:function(n){return n},success:o.success.bind(o,i),error:function(n){console.info("Error ocur in postData!");console.info(n)}})}this.addObj(i,u,f)},t.prototype.url=function(n){return this.serviceUrl+"/"+n},t.prototype.getKey=function(n){return this.serviceUrl+"/"+n},t.prototype.addObj=function(i,r,u){t.successFunc[i]?t.successFunc[i].push({success:u,convert:r}):(t.successFunc[i]=new n.List,t.successFunc[i].push({success:u,convert:r}))},t.prototype.success=function(n,i){var u,r,f;for(this.addResultCache(n,i),u=t.successFunc[n],t.successFunc[n]=null,r=0;r<u.objects.length;r++)f=u.objects[r],f.success(f.convert(i))},t.prototype.addResultCache=function(n,i){t.resultCache[n]=i;setTimeout(function(){delete t.resultCache[n]},2e3)},t.prototype.GeneralErrorHandle=function(n){console.info("Error ocur: "+n)},t}();n.BaseService=t})(Tron||(Tron={})),function(n){var t=function(){function t(n){this.app=n;this.app.subscribe(["WebSocketDataReceived"],this.onWebSocketMessage.bind(this));t.subscribers||(t.subscribers=[])}return t.prototype.onWebSocketMessage=function(i,r){var e=JSON.parse(r.data),u=new n.WebSocketMessage,f;if(u.deserialize(e),t.subscribers[u.type])for(f=0;f<t.subscribers[u.type].objects.length;f++)t.subscribers[u.type].objects[f](u)},t.prototype.addPlayer=function(n,t){this.app.websocket.send(JSON.stringify({MessageType:"addPlayer",gameId:n,name:t}))},t.prototype.updateGameState=function(n,t){this.app.websocket.send(JSON.stringify({MessageType:"tronDirectionUpdate",gameId:n,direction:t}))},t.prototype.subscribeForMessage=function(i,r){t.subscribers[i]||(t.subscribers[i]=new n.List);t.subscribers[i].push(r)},t.prototype.unsubscribeForMessage=function(n,i){if(t.subscribers[n])for(var r=0;r<t.subscribers[n].objects.length;r++)t.subscribers[n].objects[r]==i&&t.subscribers[n].objects.splice(r,1)},t}();n.WebSocketService=t}(Tron||(Tron={})),function(n){var t=function(){function t(n){this.app=n}return t.prototype.getUser=function(){if(!t.user){var i=this.app.services.get("cookies"),r=i.getCookie("name"),u=parseInt(i.getCookie("id"));t.user=new n.User;t.user.name=r;t.user.id=u}return t.user},t}();n.UsersService=t}(Tron||(Tron={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(n){function t(){return n.call(this,"api/game")||this}return __extends(t,n),t.prototype.createGame=function(n,t){var i=JSON.stringify({options:n});this.postData(i,"creategame",function(n){return n},t,i)},t}(n.BaseService);n.GameService=t}(Tron||(Tron={}));